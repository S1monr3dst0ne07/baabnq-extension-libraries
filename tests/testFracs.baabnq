
use 'libs/tests/common.baabnq';
use 'libs/chunk.baabnq';
use 'ext/fracs.baabnq';


lab Local::TestFracs::Init;
    sub Fracs::ModuleInit;
return;


lab TestFracs::Allocate;
lab TestFracs::CreateEmpty;
    sub Local::TestFracs::Init;

    sub Fracs::Allocate;
    pull _pFrac;

    push _pFrac; sub Chunk::Len; pull __;
    jump fail ~ __ != 3;

    put __ <- _pFrac + _Fracs::Frac::SIGN;  jump fail ~ __ != 0;
    put __ <- _pFrac + _Fracs::Frac::NUMER; jump fail ~ __ != 0;
    put __ <- _pFrac + _Fracs::Frac::DENER; jump fail ~ __ != 0;

    jump succ;

lab TestFracs::CreateByComponents;
    sub Local::TestFracs::Init;

    push 1;
    push 2;
    push 3;
    sub Fracs::CreateByComponents;
    pull _pFrac;

    put __ <- _pFrac + _Fracs::Frac::SIGN;  jump fail ~ __ != 1;
    put __ <- _pFrac + _Fracs::Frac::NUMER; jump fail ~ __ != 2;
    put __ <- _pFrac + _Fracs::Frac::DENER; jump fail ~ __ != 3;

    jump succ;

lab TestFracs::Delete;
    sub Local::TestFracs::Init;

    sub Fracs::CreateEmpty;
    sub Fracs::Delete;

    jump succ;

lab TestFracs::Normalize;
    sub Local::TestFracs::Init;

    push 0;
    push 17;
    push 3;
    sub Fracs::CreateByComponents;
    sub Fracs::Normalize;
    pull _pFrac;

    put __ <- _pFrac + _Fracs::Frac::SIGN;  jump fail ~ __ != 0;
    put __ <- _pFrac + _Fracs::Frac::NUMER; jump fail ~ __ != 17;
    put __ <- _pFrac + _Fracs::Frac::DENER; jump fail ~ __ != 3;

    push 1;
    push 1000;
    push 300;
    sub Fracs::CreateByComponents;
    sub Fracs::Normalize;
    pull _pFrac;

    put __ <- _pFrac + _Fracs::Frac::SIGN;  jump fail ~ __ != 1;
    put __ <- _pFrac + _Fracs::Frac::NUMER; jump fail ~ __ != 125;
    put __ <- _pFrac + _Fracs::Frac::DENER; jump fail ~ __ != 37;
    
    jump succ;

lab TestFracs::Value2Frac;
    sub Local::TestFracs::Init;

    push 12345;
    sub Fracs::Value2Frac;
    pull _pFrac;

    put __ <- _pFrac + _Fracs::Frac::SIGN;  jump fail ~ __ != 0;
    put __ <- _pFrac + _Fracs::Frac::NUMER; jump fail ~ __ != 12345;
    put __ <- _pFrac + _Fracs::Frac::DENER; jump fail ~ __ != 1;

    jump succ;

lab TestFracs::Frac2Value;
    sub Local::TestFracs::Init;

    push 12345;
    sub Fracs::Value2Frac;
    sub Fracs::Frac2Value;
    pull __;
    jump fail ~ __ != 12345;

    push 0;
    push 12;
    push 4;
    sub Fracs::CreateByComponents;
    sub Fracs::Frac2Value;
    pull __;
    jump fail ~ __ != 3;

    jump succ;


